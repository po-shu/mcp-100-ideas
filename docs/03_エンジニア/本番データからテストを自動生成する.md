# 本番データからテストを自動生成する

## アイデア
本番環境のトラフィックログとデータを安全にマスキングした上で、実際のユースケースに基づくE2EテストとシステムテストのシナリオおよびTestcaseを自動生成する。実データに基づく現実的なテストにより、従来見落としていたエッジケースの発見や、本番で実際によく使われるフローの優先的なテスト実施を可能にする。

### 具体例
マイクロサービス環境での決済システムにおいて、本番での様々な決済パターンや特殊なエッジケースを、個人情報を適切にマスキングした上でテストケースとして再現し、システム全体の品質を向上させる場面

## アーキテクチャ
| Type | Name | Role |
|--|--|--|
| Client | Claude Desktop App | テスト生成の対話型アシスタント |
| Server | PostgreSQL | マスキング済みログの分析基盤 |
| Server | GitHub | テストコードの生成と管理 |
| Server | Memory | テストパターンの蓄積 |

```mermaid
sequenceDiagram
    actor User as 品質保証エンジニア
    participant CAP as Claude Desktop App
    participant DB as PostgreSQL
    participant GH as GitHub
    participant MEM as Memory
    
    Note over User,MEM: AWS Kinesis/Glueで<br>本番ログを収集・マスキング済み

    User->>CAP: テストシナリオ生成を依頼
    CAP->>DB: アクセスパターンを分析
    DB-->>CAP: 頻出フローを返却
    CAP->>GH: 既存テストを取得
    GH-->>CAP: テストコードを返却
    CAP->>MEM: テストパターンを検索
    MEM-->>CAP: 類似ケースを返却
    CAP-->>User: テスト候補を提案<br>（カバレッジギャップを強調）
    User->>CAP: 特定フローの詳細生成を依頼
    CAP->>DB: トランザクションログを取得
    DB-->>CAP: 詳細シーケンスを返却
    CAP->>GH: 関連コードを検索
    GH-->>CAP: API仕様を返却
    CAP-->>User: Playwrightテストコードを提示
    Note over CAP,User: - ページ操作シーケンス<br>- APIリクエスト/レスポンス<br>- テストデータセット
    User->>CAP: テストデータの生成を依頼
    CAP->>DB: 本番データのパターンを分析
    DB-->>CAP: 特徴的なケースを返却
    CAP-->>User: マスキング済みテストデータ提供
    User->>CAP: GitHubへの反映を依頼
    CAP->>GH: PRを作成
    GH-->>CAP: PR URLを返却
    CAP-->>User: レビュー依頼を通知
```

## 思考プロセス

### 対象の活動の価値は何か
- 本番環境の実データに基づくテスト品質の向上
    - 実際のユースケースの網羅
    - エッジケースの発見
    - データの現実性担保
- テスト作成工数の大幅削減
    - 自動シナリオ生成
    - テストデータの自動生成
    - コード実装の自動化
- プライバシーとセキュリティの確保
    - 確実なデータマスキング
    - 機密情報の除去
    - コンプライアンス対応

### 価値を妨げる課題は何か
- データ収集とマスキングの複雑さ
    - 個人情報の特定
    - 機密データの判別
    - 整合性の維持
- テストシナリオの妥当性検証
    - 異常系の扱い
    - パフォーマンス要件
    - 依存関係の考慮
- テスト環境の制約
    - 外部サービス連携
    - データ量の制限
    - リソースの制約

### なぜ課題が発生するのか、仮説推論
- システムの複雑性
    - マイクロサービス間の依存
    - 非同期処理の存在
    - 外部サービス連携
- データの特性
    - 構造化/非構造化の混在
    - 時系列での変化
    - ビジネスルールの影響
- 運用上の制約
    - プライバシー規制
    - パフォーマンス要件
    - リソースコスト